# Ralphton 에지케이스 & 커버리지 리포트

> 작성일: 2026-03-01

## 1. 에지케이스 총괄 요약

프로젝트에서 식별된 에지케이스는 **3개 계층**으로 존재한다.

- **FMEA 레지스트리**: 32개 고장모드 (설계 시점 식별)
- **Lessons Learned**: 8개 기술적 에지케이스 (개발 중 발견)
- **런타임 발견**: 4개 신규 에지케이스 (rollout 실행 중 발견)

**총 44개 에지케이스**, 자동화 테스트 커버리지: **0%** (테스트 프레임워크 미설치)

---

## 2. FMEA 레지스트리 — 32개 고장모드 커버리지

### Tier 1 (SPS > 20) — 최우선 구현 대상 4개

- **FM-D02** 레고 극도 분산 (SPS 24.0)
  - 커버리지: **시나리오 생성 완료** — v2 52ep에 포함
  - rollout 검증: **미완료** (0% 성공률)

- **FM-A03** 저조도 환경 (SPS 24.0)
  - 커버리지: **시나리오 파라미터 설계만 완료** (`lighting: "dim"`)
  - 실제 에피소드 생성: **미확인** (v2/v3에 명시적 포함 여부 불명)

- **FM-A01** 바닥색 동일 레고 (SPS 21.0)
  - 커버리지: **시나리오 파라미터 설계만 완료** (`lego_colors: ["#c4a882"]`)
  - 실제 에피소드 생성: **미확인**

- **FM-C01** 벽/코너 밀착 레고 (SPS 20.0)
  - 커버리지: **v2 시나리오에 포함** (FM-C01 5개)
  - rollout에서 **WALL_STUCK 발견** → v5 wall patch 24ep 생성
  - Wall FT 진행 중 (해커톤 종료 시점 미완료)

### Tier 2 (SPS 5~20) — 23개

**시나리오에 포함된 것** (v2에서 명시적으로 생성):

- FM-C02 밀집 클러스터 (SPS 17.5) — v2 5개 시나리오 ✅
- FM-C04 초대형 레고 (SPS 10.0) — v2 3개 시나리오 ✅

**v4 시나리오에 포함** (LIFTING_LOOP_TRAP 대응):

- FM-D01 코너 고착 (SPS 15.0) — v4 recovery 15개에 간접 포함
- FM-F01 버킷-바닥 끼임 (SPS 15.0) — v4에 간접 포함

**v5 시나리오에 포함** (WALL_STUCK 대응):

- FM-B05 금지 물체 인접 (SPS 14.0) — v5 wall-aware 20개에 간접 포함

**시나리오 미생성** (나머지 18개):

- FM-C03 운반 중 낙하 (SPS 16.0) — 미구현
- FM-A07 비레고 잡동사니 (SPS 15.0) — 미구현
- FM-D03 최원거리 시작 (SPS 15.0) — 미구현
- FM-A05 가구 사이 좁은 공간 (SPS 14.0) — 미구현
- FM-A02 방향성 조명 (SPS 13.3) — 미구현
- FM-C05 부분 가림 (SPS 11.7) — 미구현
- FM-B03 애완동물 (SPS 11.25) — 미구현
- FM-C06 초소형 레고 (SPS 10.5) — 미구현
- FM-B04 아이 (SPS 10.0) — 미구현
- FM-F02 유령 타겟 (SPS 8.0) — 미구현
- FM-F03 센서 노이즈 (SPS 8.0) — 미구현
- FM-E01 조명 변화 (SPS 7.5) — 미구현
- FM-D04 예상외 정적 장애물 (SPS 7.0) — 미구현
- FM-B01 절벽/계단 (SPS 6.75) — 미구현
- FM-A06 반사 바닥 (SPS 6.7) — 미구현
- FM-A04 바닥 경사 (SPS 6.0) — 미구현
- FM-C08 수거함 만원 (SPS 5.3) — 미구현
- FM-C07 바닥 밀착 레고 (SPS 5.0) — 미구현

### Tier 3 (SPS < 5) — 5개

전부 **미구현** (Domain Randomization으로 근사 예정이었으나 시간 부족):

- FM-E02 레고 위치 변경 (SPS 4.8)
- FM-B06 경사로 고속 하강 (SPS 4.2)
- FM-B02 바닥 구멍 (SPS 4.0)
- FM-E04 바닥 함몰 (SPS 1.8)
- FM-E03 문 열림 (SPS 1.5)

---

## 3. Lessons Learned — 기술적 에지케이스 8개

- **LL-1** 물리 엔진 회전 관성 → **해결 ✅** (kinematic yaw 제어 적용)
- **LL-2** CANNON vs THREE.js `setFromEuler()` 차이 → **해결 ✅**
- **LL-3** 상태 전환 시 잔류 velocity → **해결 ✅** (매 프레임 리셋)
- **LL-4** 이산 액션 좌우 진동 → **해결 ✅** (threshold + 비례 조향)
- **LL-5** 카메라 초기 위치 미설정 → **해결 ✅**
- **LL-6** camera.up 벡터 roll → **해결 ✅** (매 프레임 `camera.up.set(0,1,0)`)
- **LL-7** headless-gl WebGL 1.0 제한 → **해결 ✅** (Draco/SkinnedMesh 회피)
- **LL-8** 1920x1080 OOM → **해결 ✅** (640x480 고정)

커버리지: **8/8 해결 (100%)**

---

## 4. 런타임 발견 에지케이스 — 4개

- **LIFTING_LOOP_TRAP** (07:00 KST 확정)
  - 증상: ACT 모델이 LIFTING 상태에서 TRANSPORTING으로 전환 불가
  - 원인: expert-only 50ep에 error recovery 시퀀스 없음 (covariate shift)
  - 대응: v3 200ep recovery 시퀀스 추가 → v3 2nd-stage 파인튜닝
  - 결과: 07:25 Ep25 rollout에서 **LIFTING→TRANSPORTING 전환 작동 확인 ✅**

- **WALL_STUCK** (07:25 KST 발견)
  - 증상: 로더가 벽 근처(-7.5, -7.5)에서 탈출 불가
  - 원인: 벽 근처 시나리오가 학습 데이터에 없음
  - 대응: v5 wall-aware expert 24ep + Wall FT (10ep, lr=2e-6)
  - 결과: **미완료** (해커톤 종료 시 Ep2~/10 진행 중)

- **Rollout Compounding Error** (03:43 KST 확정)
  - 증상: 오프라인 Loss 0.000080인데 closed-loop 성공률 0%
  - 원인: ImageNet 정규화 불일치 + covariate shift
  - 대응: 정규화 제거 + receding horizon + recovery 시퀀스
  - 결과: **부분 해결** (LIFTING_LOOP_TRAP 해소, WALL_STUCK 잔존)

- **Action Bias** (Loop 1에서 발견)
  - 증상: bucket 76% zero, lift 84% zero
  - 원인: 초기 시나리오의 액션 다양성 부족
  - 대응: v2에서 action-rich 시나리오 13개 추가 (FM-C01/C02/C04)
  - 결과: **해결 ✅** (v2 학습 후 분포 개선)

---

## 5. 커버리지 요약 대시보드

### 카테고리별 커버리지

- **A (환경 위험)** 7개 → 시나리오 생성 0~1개 / 7 = **~14%**
- **B (안전 위협)** 6개 → 시나리오 생성 0개 / 6 = **0%**
- **C (수거 조작)** 8개 → 시나리오 생성 3개 / 8 = **37.5%**
- **D (탐색/경로)** 4개 → 시나리오 생성 1~2개 / 4 = **~37.5%**
- **E (동적 환경)** 4개 → 시나리오 생성 0개 / 4 = **0%**
- **F (로봇 내부)** 3개 → 시나리오 생성 1개 / 3 = **~33%**
- **LL (기술 에지케이스)** 8개 → 해결 8개 / 8 = **100%**
- **런타임 발견** 4개 → 해결 2개 / 4 = **50%**

### 전체 요약

- FMEA 32개 중 **시나리오로 실제 생성된 것: ~8개 (25%)**
- FMEA 32개 중 **rollout 검증까지 완료: 0개 (0%)** (전체 rollout 성공률이 0%였으므로)
- 기술적 LL 8개: **100% 해결**
- 런타임 4개: **50% 해결** (2/4)
- 자동화 테스트 (unit/integration): **0%** (테스트 프레임워크 없음)

### 데이터 기준 에피소드 커버리지

- **v1**: ~10ep (기본 검증)
- **v2**: 52ep (FM-C01 5개, FM-C02 5개, FM-C04 3개 포함)
- **v3**: 200ep (recovery 시퀀스 포함, LIFTING_LOOP_TRAP 대응)
- **v5**: 24ep (wall-aware expert, WALL_STUCK 대응)
- **총 ~286ep** / 목표 1,000ep = **28.6%**

---

## 6. 핵심 미커버 영역 (Critical Gaps)

1. **안전 카테고리 전체 미커버** — FM-B01~B06 모두 시나리오 미생성. 실제 배포 시 가장 위험
2. **동적 환경 전체 미커버** — FM-E01~E04 모두 미구현. sim-to-real 전이 시 취약
3. **Rollout 검증 0%** — 오프라인 메트릭만으로는 실제 동작 보장 불가 (이번 해커톤의 핵심 교훈)
4. **자동화 테스트 부재** — claw-bot.js의 순수 함수들(`parseStatus`, `detectAgent`, `mention` 등)조차 테스트 없음
